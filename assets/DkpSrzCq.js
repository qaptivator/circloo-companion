import{ar as y,av as b}from"./-1Vb8plG.js";function x(){const{$axios:t}=b();return t}const S=9,I="-nodwl",h="0";var M=(t=>(t.Latest="latest",t.Search="search",t.Yours="yours",t))(M||{}),k=(t=>(t.All="all",t.ModQueue="modQueue",t.Modded="modded",t))(k||{}),T=(t=>(t.Unmodded="unmodded",t.Modded="modded",t.Unknown="unknown",t))(T||{});async function g(t,n,e=!1){try{return(await x()({method:"POST",url:t,params:n,paramsSerializer:a=>(a.level&&!a.levels&&!e&&(a.levels=a.level,a.level=void 0),new URLSearchParams(a).toString())})).data}catch(o){throw y().add({severity:"error",summary:"HTTPS request failed. See the console for more information",detail:"Contact the developer so that they will fix the issue. Error: thumbnail blob is not a square (width != height)",life:3e3}),o}}function R(t){return t.totalPlayTime/t.totalPlayTimePeople}function _(t){const n=t.x/255*360,e=t.y/255,o=t.z/255;let s=0,a=0,c=0;const l=Math.floor(n/60),i=n/60-l,r=o*(1-e),d=o*(1-i*e),u=o*(1-(1-i)*e);switch(l%6){case 0:s=o,a=u,c=r;break;case 1:s=d,a=o,c=r;break;case 2:s=r,a=o,c=u;break;case 3:s=r,a=d,c=o;break;case 4:s=u,a=r,c=o;break;case 5:s=o,a=r,c=d;break}return{x:Math.round(s*255),y:Math.round(a*255),z:Math.round(c*255)}}function z(t){let[n,e,o]=[t.x/255,t.y/255,t.z/255],s=Math.max(n,e,o),a=Math.min(n,e,o),c=s,l=s,i=s,r=s-a;if(l=s===0?0:r/s,s===a)c=0;else{switch(s){case n:c=(e-o)/r+(e<o?6:0);break;case e:c=(o-n)/r+2;break;case o:c=(n-e)/r+4;break}c/=6}return{x:c,y:l,z:i}}function f(t,n,e){let o=Math.round(t.x*(1-e)+n.x*e),s=Math.round(t.y*(1-e)+n.y*e),a=Math.round(t.z*(1-e)+n.z*e);return{x:o,y:s,z:a}}function A(t){const n={x:0,y:0,z:0},e={x:128,y:128,z:128},o=_({x:t,y:210,z:255}),s=f(o,e,.3),a=f(s,n,.6),c=f(a,n,.2);return{background:s,main:a,player:c}}function E(t){return A(t.color)}function D(t,n,e){const o=1-e,s=(t.x-n.x*e)/o,a=(t.y-n.y*e)/o,c=(t.z-n.z*e)/o;return{x:Math.max(0,Math.min(255,Math.round(s))),y:Math.max(0,Math.min(255,Math.round(a))),z:Math.max(0,Math.min(255,Math.round(c)))}}function P(t){const e=D(t,{x:128,y:128,z:128},.3),o=z(e);return Math.round(o.x*255)}async function N(t){function n(i){return i.toString(16).padStart(2,"0")}function e(){const i=n(t.color),r=parseInt(i.slice(0,2),16),d=parseInt(i.slice(2,4),16),u=parseInt(i.slice(4,6),16);return P({x:r,y:d,z:u})}const o=`data:image/png;base64,${t.imageURI.slice(7)}`,s=await fetch(o).then(i=>i.blob());let a=0;const c=t.content.indexOf("COLORS");if(c===-1)a=e();else{const i=[];for(let r=c+7;r<t.content.length;r++){const d=t.content[r];if(isNaN(Number(d)))break;i.push(d)}a=parseInt(i.join(""),10)}let l="unknown";return parseInt(t.moderationStatus)===0?l="unmodded":parseInt(t.moderationStatus)===1&&(l="modded"),t!=null&&t.description&&(t!=null&&t.description.includes(I))&&(t.content=""),{id:t.id,name:t.name,description:t.description,walkthroughLink:t.walkthroughLink,creator:t.creator,content:t.content,imageURI:s,creationTime:new Date(t.creationTime),color:a,totalPlayTime:t.totalPlayTime,totalPlayTimePeople:t.totalPlayTimePeople,bestScore:t.bestScore,featured:t.featured,plays:t.plays,starts:t.starts,totalCompletions:t.totalCompletions,stars:t.upvotes,moderationStatus:l,version:t.version,bestScoreLog:t.bestScoreLog,deviceID:t.deviceID,additionalInfo:t.additionalInfo}}async function p(t){let n=[];for(const e of t.levels)n.push(await N(e));return n}async function O(t,n,e,o,s){return await g("GetLevels",{sortMode:t,page:n,itemsPerPage:e,spec:o,query:s,supportsCollections:2,cachedLevels:null,pagingInfo:null,version:S,deviceID:h})}async function U(t,n,e,o,s){return await p(await O(t,n,e,o,s))}async function q(t){const n={levels:t.join(","),deviceID:h},e=await g("GetLevelsById",n);return await p(e)}async function $(t){return await g("GetLevelAdvancedInfo",{level:t,deviceID:h},!0)}function j(t){const n=t/60,e=Math.floor(n/60),o=Math.floor(n%60),s=Math.floor(n%1*100);return`${e}:${o.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}const m="level_metadata";function G(t){const n={id:t.id,bookmarked:!1},e=JSON.parse(localStorage.getItem(m)||"{}");return e&&e.length>0&&e.find(s=>s.id===t.id)||n}function H(t,n){const e=JSON.parse(localStorage.getItem(m)||"[]"),o=e.findIndex(s=>s.id===t.id);o!==-1?e[o]=Object.assign(e[o],n):e.push(n),localStorage.setItem(m,JSON.stringify(e))}function J(){return JSON.parse(localStorage.getItem(m)||"[]")}export{S as L,T as M,I as N,k as S,q as a,U as b,M as c,$ as d,G as e,E as f,J as g,j as h,R as i,A as j,H as s};
