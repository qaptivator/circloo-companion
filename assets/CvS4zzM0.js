import{av as b}from"./BlgOBYaY.js";function x(){const{$axios:t}=b();return t}const I=9,S="-nodwl",g="0";var M=(t=>(t.Latest="latest",t.Search="search",t.Yours="yours",t))(M||{}),k=(t=>(t.All="all",t.ModQueue="modQueue",t.Modded="modded",t))(k||{}),_=(t=>(t.Unmodded="unmodded",t.Modded="modded",t.Rejected="rejected",t.LimitedVisibility="limited visibility",t.Unknown="unknown",t))(_||{});async function y(t,n,e=!1,o){try{return(await x()({method:"POST",url:t,signal:o,params:n,paramsSerializer:a=>(a.level&&!a.levels&&!e&&(a.levels=a.level,a.level=void 0),new URLSearchParams(a).toString())})).data}catch(s){throw s}}function C(t){return t.totalPlayTime/t.totalPlayTimePeople}function T(t){const n=t.x/255*360,e=t.y/255,o=t.z/255;let s=0,c=0,a=0;const r=Math.floor(n/60),l=n/60-r,i=o*(1-e),d=o*(1-l*e),u=o*(1-(1-l)*e);switch(r%6){case 0:s=o,c=u,a=i;break;case 1:s=d,c=o,a=i;break;case 2:s=i,c=o,a=u;break;case 3:s=i,c=d,a=o;break;case 4:s=u,c=i,a=o;break;case 5:s=o,c=i,a=d;break}return{x:Math.round(s*255),y:Math.round(c*255),z:Math.round(a*255)}}function z(t){let[n,e,o]=[t.x/255,t.y/255,t.z/255],s=Math.max(n,e,o),c=Math.min(n,e,o),a=s,r=s,l=s,i=s-c;if(r=s===0?0:i/s,s===c)a=0;else{switch(s){case n:a=(e-o)/i+(e<o?6:0);break;case e:a=(o-n)/i+2;break;case o:a=(n-e)/i+4;break}a/=6}return{x:a,y:r,z:l}}function f(t,n,e){let o=Math.round(t.x*(1-e)+n.x*e),s=Math.round(t.y*(1-e)+n.y*e),c=Math.round(t.z*(1-e)+n.z*e);return{x:o,y:s,z:c}}function A(t){const n={x:0,y:0,z:0},e={x:128,y:128,z:128},o=T({x:t,y:210,z:255}),s=f(o,e,.3),c=f(s,n,.6),a=f(c,n,.2);return{background:s,main:c,player:a}}function E(t){return A(t.color)}function D(t,n,e){const o=1-e,s=(t.x-n.x*e)/o,c=(t.y-n.y*e)/o,a=(t.z-n.z*e)/o;return{x:Math.max(0,Math.min(255,Math.round(s))),y:Math.max(0,Math.min(255,Math.round(c))),z:Math.max(0,Math.min(255,Math.round(a)))}}function N(t){const e=D(t,{x:128,y:128,z:128},.3),o=z(e);return Math.round(o.x*255)}async function O(t){function n(i){return i.toString(16).padStart(2,"0")}function e(){const i=n(t.color),d=parseInt(i.slice(0,2),16),u=parseInt(i.slice(2,4),16),p=parseInt(i.slice(4,6),16);return N({x:d,y:u,z:p})}const o=`data:image/png;base64,${t.imageURI.slice(7)}`,s=await fetch(o).then(i=>i.blob());let c=0;const a=t.content.indexOf("COLORS");if(a===-1)c=e();else{const i=[];for(let d=a+7;d<t.content.length;d++){const u=t.content[d];if(isNaN(Number(u)))break;i.push(u)}c=parseInt(i.join(""),10)}const r=parseInt(t.moderationStatus);let l="unknown";return r===0?l="unmodded":r===1?l="modded":r===2?l="rejected":r===3&&(l="limited visibility"),t!=null&&t.description&&(t!=null&&t.description.includes(S))&&(t.content=""),{id:t.id,name:t.name,description:t.description,walkthroughLink:t.walkthroughLink,creator:t.creator,content:t.content,imageURI:s,creationTime:new Date(t.creationTime),color:c,totalPlayTime:t.totalPlayTime,totalPlayTimePeople:t.totalPlayTimePeople,bestScore:t.bestScore,featured:t.featured,plays:t.plays,starts:t.starts,totalCompletions:t.totalCompletions,stars:t.upvotes,moderationStatus:l,version:t.version,bestScoreLog:t.bestScoreLog,deviceID:t.deviceID,additionalInfo:t.additionalInfo}}async function h(t){if(!t||!t.levels||!Array.isArray(t.levels)||t.levels.length===0)return[];let n=[];for(const e of t.levels)n.push(await O(e));return n}async function P(t,n,e,o,s,c){return await y("GetLevels",{sortMode:t,page:n,itemsPerPage:e,spec:o,query:s,supportsCollections:2,cachedLevels:null,pagingInfo:null,version:I,deviceID:g},!1,c)}async function j(t,n,e,o,s,c){return await h(await P(t,n,e,o,s,c))}async function v(t){const n={levels:t.join(","),deviceID:g},e=await y("GetLevelsById",n);return await h(e)}async function U(t){return await y("GetLevelAdvancedInfo",{level:t,deviceID:g},!0)}function $(t){const n=t/60,e=Math.floor(n/60),o=Math.floor(n%60),s=Math.floor(n%1*100);return`${e}:${o.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}const m="level_metadata";function G(t){const n={id:t.id,bookmarked:!1},e=JSON.parse(localStorage.getItem(m)||"{}");return e&&e.length>0&&e.find(s=>s.id===t.id)||n}function J(t,n){const e=JSON.parse(localStorage.getItem(m)||"[]"),o=e.findIndex(s=>s.id===t.id);o!==-1?e[o]=Object.assign(e[o],n):e.push(n),localStorage.setItem(m,JSON.stringify(e))}function V(){return JSON.parse(localStorage.getItem(m)||"[]")}export{I as L,_ as M,S as N,M as S,v as a,j as b,k as c,U as d,G as e,E as f,V as g,$ as h,C as i,A as j,J as s};
