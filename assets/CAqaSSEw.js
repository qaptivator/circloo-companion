import{ar as y,av as S}from"./ChCXS2Ju.js";function I(){const{$axios:t}=S();return t}const b=9,x="-nodwl",p="0";var T=(t=>(t.Latest="latest",t.Search="search",t.Yours="yours",t))(T||{}),_=(t=>(t.All="all",t.ModQueue="modQueue",t.Modded="modded",t))(_||{}),k=(t=>(t.Unmodded="unmodded",t.Modded="modded",t.Unknown="unknown",t))(k||{});async function g(t,n,e=!1){try{return(await I()({method:"POST",url:t,params:n,paramsSerializer:s=>(s.level&&!s.levels&&!e&&(s.levels=s.level,s.level=void 0),new URLSearchParams(s).toString())})).data}catch(o){throw y().add({severity:"error",summary:"HTTPS request failed. See the console for more information",detail:"Contact the developer so that they will fix the issue. Error: thumbnail blob is not a square (width != height)",life:3e3}),o}}function O(t){return t.totalPlayTime/t.totalPlayTimePeople}function M(t){const n=t.x/255*360,e=t.y/255,o=t.z/255;let a=0,s=0,r=0;const l=Math.floor(n/60),c=n/60-l,i=o*(1-e),d=o*(1-c*e),f=o*(1-(1-c)*e);switch(l%6){case 0:a=o,s=f,r=i;break;case 1:a=d,s=o,r=i;break;case 2:a=i,s=o,r=f;break;case 3:a=i,s=d,r=o;break;case 4:a=f,s=i,r=o;break;case 5:a=o,s=i,r=d;break}return{x:Math.round(a*255),y:Math.round(s*255),z:Math.round(r*255)}}function m(t,n,e){let o=Math.round(t.x*(1-e)+n.x*e),a=Math.round(t.y*(1-e)+n.y*e),s=Math.round(t.z*(1-e)+n.z*e);return{x:o,y:a,z:s}}function A(t){const n={x:0,y:0,z:0},e={x:128,y:128,z:128},o=M({x:t,y:210,z:255}),a=m(o,e,.3),s=m(a,n,.6),r=m(s,n,.2);return{background:a,main:s,player:r}}function z(t){return A(t.color)}async function D(t){function n(c){return c.toString(16).padStart(2,"0")}function e(){const c=n(t.color),i=parseInt(c.slice(0,2),16);return parseInt(c.slice(2,4),16),parseInt(c.slice(4,6),16),i}const o=`data:image/png;base64,${t.imageURI.slice(7)}`,a=await fetch(o).then(c=>c.blob());let s=0;const r=t.content.indexOf("COLORS");if(r===-1)s=e();else{const c=[];for(let i=r+7;i<t.content.length;i++){const d=t.content[i];if(isNaN(Number(d)))break;c.push(d)}s=parseInt(c.join(""),10)}let l="unknown";return parseInt(t.moderationStatus)===0?l="unmodded":parseInt(t.moderationStatus)===1&&(l="modded"),t.description.includes(x)&&(t.content=""),{id:t.id,name:t.name,description:t.description,walkthroughLink:t.walkthroughLink,creator:t.creator,content:t.content,imageURI:a,creationTime:new Date(t.creationTime),color:s,totalPlayTime:t.totalPlayTime,totalPlayTimePeople:t.totalPlayTimePeople,bestScore:t.bestScore,featured:t.featured,plays:t.plays,starts:t.starts,totalCompletions:t.totalCompletions,stars:t.upvotes,moderationStatus:l,version:t.version,bestScoreLog:t.bestScoreLog,deviceID:t.deviceID,additionalInfo:t.additionalInfo}}async function h(t){let n=[];for(const e of t.levels)n.push(await D(e));return n}async function P(t,n,e,o,a){return await g("GetLevels",{sortMode:t,page:n,itemsPerPage:e,spec:o,query:a,supportsCollections:2,cachedLevels:null,pagingInfo:null,version:b,deviceID:p})}async function C(t,n,e,o,a){return await h(await P(t,n,e,o,a))}async function E(t){const n={levels:t.join(","),deviceID:p},e=await g("GetLevelsById",n);return await h(e)}async function R(t){return await g("GetLevelAdvancedInfo",{level:t,deviceID:p},!0)}function v(t){const n=t/60,e=Math.floor(n/60),o=Math.floor(n%60),a=Math.floor(n%1*100);return`${e}:${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}const u="level_metadata";function U(t){const n={id:t.id,bookmarked:!1},e=JSON.parse(localStorage.getItem(u)||"{}");return e&&e.length>0&&e.find(a=>a.id===t.id)||n}function q(t,n){const e=JSON.parse(localStorage.getItem(u)||"[]"),o=e.findIndex(a=>a.id===t.id);o!==-1?e[o]=Object.assign(e[o],n):e.push(n),localStorage.setItem(u,JSON.stringify(e))}function $(){return JSON.parse(localStorage.getItem(u)||"[]")}export{b as L,k as M,x as N,_ as S,E as a,C as b,T as c,R as d,U as e,z as f,$ as g,v as h,O as i,A as j,q as s};
